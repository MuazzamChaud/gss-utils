# Defining Dimension Columns

> This document is part of a wider discussion on [Defining Columns in an info.json v1.1](./README.md).

All dimensions used or generated by the csvwlib tool **must point to URI resources**. Whilst the qb spec [does permit dimensions with literal values](https://www.w3.org/TR/vocab-data-cube/#h3_dsd-example), our requirement to be able to upload data to the PMD platform and ensure that it is filterable requires that dimension values are URI resources which are part of a code-list. Even date/time fields must use the [reference.data.gov.uk Time Intervals Ontology](https://github.com/epimorphics/IntervalServer/blob/master/interval-uris.md).

The URI resources that dimension values point to should be defined in a `skos:ConceptScheme` (i.e. code-list). It is advantageous to re-use these codelists wherever possible.

N.B. [Dimensions are *required* components](https://www.w3.org/TR/vocab-data-cube/#ic-11), i.e. you *must* provide a value for every dimension in every observation-row.

The rest of this document will present examples of dimension column definitions which you may find useful.

## New Dimension

Defines a new dimension where:

* the dimension property's label is the same as the CSV column's title
* a dataset-local code-list is automatically generated from the unique values found in the column.

```json
{
    "type": "dimension"
}
```

## Existing Dimension

Re-uses an existing dimension property defined at `http://example.com/dimensions/this-dimension`

```json
{
    "type": "dimension",
    "uri": "http://example.com/dimensions/this-dimension",
    "value": "http://example.com/code-lists/the-code-list-for-this-dimension/{+column_name}"
}
```

**N.B. You must provide the `value` when defining existing dimensions**. This defines how the values in the column's cells are mapped into URIs pointing to concepts in the dimension's code-list (which is already defined and cannot be altered here). See [RFC 6570](https://datatracker.ietf.org/doc/html/rfc6570) for more information on the URI templating syntax used and [here](https://www.w3.org/TR/2015/REC-tabular-metadata-20151217/#uri-template-properties) for more information on their use within CSV-Ws.

## New Dimension **Without** Code-List

Defines a new dimension which does not have a code-list. Dimensions aren't required to have their values defined in code-lists, however it is recommended. Without a suitable code-list, filtering on this dimension in PMD isn't possible.

Setting no code-list is a sensible approach when using date-time period dimensions because there is not and can never be a definitive code-list spanning all possible time periods. In this case, the Jenkins build process identifies said columns by the fact that dimensions have `"subPropertyOf": "http://purl.org/linked-data/sdmx/2009/dimension#refPeriod"` specified. Once identified, local date-time code-lists for these columns are automatically generated; this process cannot succeed if a code-list already exists, so `"codelist": false` must be set.

```json
{
    "type": "dimension",
    "new": {
        "codelist": false
    }
}
```

## New Dimension with Existing Code-List

This defines a new dimension where we re-use an existing code-list defined on PMD (`http://data.europa.eu/nuts/scheme/2016`).

```json
{
    "type": "dimension",
    "new": {
        "codelist": "http://data.europa.eu/nuts/scheme/2016"
    }
}
```

**N.B. the `codelist` value must point to the `skos:ConceptScheme`'s URI.**

## New Dimension with Local *Manually Defined* Code-List

This defines a new dimension which uses a dataset-local code-list which is already defined in a CSV-W file (`./codelists/some-file.csv-metadata.json`).

```json
{
    "type": "dimension",
    "new": {
        "codelist": "./codelists/some-file.csv-metadata.json"
    }
}
```

**N.B. the `codelist` value must point to the code-list's metadata JSON file on disk.**

## New Dimension - Everything Specified

This example demonstrates all of the properties which is is possible to set against a new dimension object.

```json
{
    "type": "dimension",
    "new": {
        "label": "This dimension's Name",
        "path": "some-dimension-path",
        "comment": "I can describe the dimension is more detail here. I cannot use MarkDown or HTML.",
        "isDefinedBy": "http://example.com/definitions/something-which-explains-what-this-dimension-means.pdf",
        "subPropertyOf": "http://example.com/dimensions/something-more-generic",
        "codelist": "http://example.com/code-lists/some-code-list"
    }
}
```

**N.B.**

* **the `path` represents the final part of the URI which identifies this dimension**. For example if all dimensions are typically stored under `http://example.com/dimensions/`, then this dimension would have a URI of `http://example.com/dimensions/some-dimension-path`
* **the `subPropertyOf` represents a parent dimension property which is a more general representation of this dimension**. This dimension is a specialisation of the parent dimension.
* The `isDefinedBy` property provides the URL to a document which helps provide a human-friendly definition of this dimension.

## Date-Time Dimensions

All date/time dimensions should make use of the `http://reference.data.gov.uk/id` datetime period identifiers. In order to ensure that a local date-time code-list is correctly generated **re-using the `http://reference.data.gov.uk/id` identifiers**, you must specify:

* the **subPropertyOf** must be `http://purl.org/linked-data/sdmx/2009/dimension#refPeriod` 
* the **value** template must start with `http://reference.data.gov.uk/id/` and must correctly map the column's values to valid URIs, e.g. `http://reference.data.gov.uk/id/year/{+period}` 
* the **codelist** value should be set to `true` to enable auto-generation of the code-list

If any of the above criteria are not met then a date-time code-list will not be generated. Note that the Jenkins csvcubed upload process does not generate date-time code-lists.

```json
"Year": {
    "type": "dimension",
    "new": {
        "subPropertyOf": "http://purl.org/linked-data/sdmx/2009/dimension#refPeriod",
        "codelist": true
    },
    "value": "http://reference.data.gov.uk/id/year/{+year}"
},
```

**N.B.**

* This functionality **will not work** if the dimension's `uri` is set to `sdmxd:refPeriod`. You must ensure it is the parent dimension which is set to `sdmxd:refPeriod`.
* an analogous process can be applied to the info.json v1.0 syntax to auto-generate date-time code-lists